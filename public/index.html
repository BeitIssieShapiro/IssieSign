<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />

    <style>
        html,
        body {
            height: 100%;
            max-width: 100%;
        }
    </style>

    <title>Sign Language Application</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <script>
        window.isBrowser = false;

        let assetsInit = false;
        let assetsInit2 = false;

       
        function doNothing(e) {
            if (document.swipeInProgress) {
                const dx = e.touches[0].clientX - document.swipeInProgress.initial.x;
                const dy = e.touches[0].clientY - document.swipeInProgress.initial.y;
                
                const arg = {
                    x: document.swipeInProgress.initialPos.x + dx,
                    y: document.swipeInProgress.initialPos.y + dy,
                }
                document.swipeHandler.setCurrent(e, arg);

            } else {
                if (document.swipeHandler) {
                    console.log("start swipe", e.target,  e.touches[0].clientX, e.touches[0].clientY);
                    document.swipeInProgress = {
                        initial: {
                            x: e.touches[0].clientX,
                            y: e.touches[0].clientY,
                        },
                        initialPos: document.swipeHandler.getCurrent(),
                    }
                }
            }
            if (document.preventTouch) {
                e.preventDefault();
            }
        }


        var handleOpenURL = (url) => {
            console.log("handleOpenURL", url, window.openWith !== undefined?"open with exists":"missin")
            if (window.openWith) {
                window.openWith(url);
            }
        }

        function getAssetsInfo() {
            console.log("getAssetsInfo");

            window.PlayAssets.getPlayAssets((assets)=> {
                if (assets && assets.ready && assets.assets.length === 2) {
                    document.assetsReady = true;
                    
                    if (assets.assets[0].name === "issiesign_assets") {
                        document.basePath = "__cdvfile_root__" + assets.assets[0].path + "/";
                        document.basePath2 = "__cdvfile_root__" + assets.assets[1].path + "/";
                    } else {
                        document.basePath = "__cdvfile_root__" + assets.assets[1].path + "/";
                        document.basePath2 = "__cdvfile_root__" + assets.assets[0].path + "/";
                    }
                    
                    
                } else {
                    if (assets) {
                        document.downloadPercent = assets.downloadPercent;
                        document.totalSizeToDownload = assets.totalSizeToDownload;
                        document.fileIndex = assets.fileIndex;
                        
                        console.log("Downloading...", assets.downloadPercent);
                    }
                    console.log("retry getting getAssetsInfo")
                    setTimeout(getAssetsInfo, 1500);
                }
            })
        }


        function onDeviceReady() {
            console.log("Cordova: Device Is Ready");
            window.isBrowser = false;

            
            if (cordova.file.applicationDirectory.includes('android_asset')) {
                // Android:
                console.log("Device is Android")
                window.isAndroid = true;
                
                //https://localhost/__cdvfile_assets__/ == assets/www
                window.documents = cordova.file.dataDirectory;
                // would be file:///data/user/0/com.issieshapiro.myissiesign/files/

                // todo - adjust once issie sign has own app-id
                const isMyIssieSign = window.documents.includes("com.issieshapiro.myissiesign"); 


                document.basePath = "https://localhost/__cdvfile_assets__/";
                if (!isMyIssieSign) {
                    document.assetsReady = false;

                    window.PlayAssets.initPlayAssets(["issiesign_assets", "issiesign_assets3"])
                    getAssetsInfo();
                } 
                
                if (!cordova.openwith) {
                    console.log("cordova.openwith is undefined");
                }
                cordova.openwith?.init(
                    () => {
                        console.log("open with init success");
                        cordova.openwith.addHandler((intent) => {
                            console.log("open with handler called");
                            if (intent.items.length == 1) {
                                let url = intent.items[0].uri
                                console.log("open with url:", url);

                                if (window.openWith) {
                                    console.log("open with started");
                                    window.openWith(url);
                                }
                            }
                        });
                    },
                    (err) => console.log("open with init error", err));

            } else {
                //only in iOS
                console.log("Device is iOS");
                window.isAndroid = false;
                document.basePath = cordova.file.applicationDirectory;
                window.documents = cordova.file.documentsDirectory;
                document.assetsReady=true;
            }
            console.log("base path:", document.basePath, "window.documents:", window.documents);
        }

        document.assetsReady = true;
        document.preventTouch = true;

        document.addEventListener("touchmove", doNothing, { passive: false });
        document.addEventListener("touchend", (e)=>{document.swipeInProgress = undefined;}, { passive: false });
        document.addEventListener("deviceready", onDeviceReady, false);
    </script>
</head>

<body theme="blue">
    <div class="container-fluid AppHolder" style="position: fixed; height:100%; width:100%; top:0; left:0;">
    </div>
</body>

</html>